{% extends 'base.html' %}
{% block title %}{{ post.title }} Â· MuhaBlog{% endblock %}

{% block content %}
<article class="card">
  <div class="card__meta">
    <div class="muted">
      <strong>{{ author.username if author else ('user#' ~ post.author_id) }}</strong>
      Â· {{ post.created_at.strftime('%Y-%m-%d %H:%M') if post.created_at else '' }}
      Â· ğŸ‘ {{ post.view_count }}
    </div>
    <div class="badges">
      {% for c in categories %}
        <span class="badge" style="border-color: {{ c.color }}">{{ c.name }}</span>
      {% endfor %}
    </div>
  </div>

  <h1 class="post__title">{{ post.title }}</h1>
  <div class="post__content prose">{{ post_html | safe }}</div>

  <div class="post__bar">
    <div class="muted">ğŸ‘ {{ counts.likes }} Â· ğŸ‘ {{ counts.dislikes }} Â· â­ {{ counts.favorites }}</div>

    {% if request.state.is_authenticated %}
    <div class="btnrow">
      <button class="btn btn--ghost" data-action="like" data-post-id="{{ post.id }}">ğŸ‘</button>
      <button class="btn btn--ghost" data-action="dislike" data-post-id="{{ post.id }}">ğŸ‘</button>
      <button class="btn {% if favorited %}btn--primary{% else %}btn--ghost{% endif %}" data-action="favorite" data-post-id="{{ post.id }}">â­</button>
      {% if request.state.role in ['admin','moderator'] or request.state.user_id|int == post.author_id %}
        <a class="btn btn--ghost" href="/posts/{{ post.id }}/edit">Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ</a>
        <form method="post" action="/posts/{{ post.id }}/delete" style="display:inline">
          <button class="btn btn--danger" type="submit">Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ</button>
        </form>
      {% endif %}
    </div>
    {% else %}
      <div class="muted">Ğ§Ñ‚Ğ¾Ğ±Ñ‹ Ğ»Ğ°Ğ¹ĞºĞ°Ñ‚ÑŒ, ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑÑ‚ÑŒ â€” Ğ²Ğ¾Ğ¹Ğ´Ğ¸Ñ‚Ğµ.</div>
    {% endif %}
  </div>
</article>

<section class="stack">
  <h2>ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸</h2>

  {% if request.state.is_authenticated %}
  <form class="card" id="commentForm" data-post-id="{{ post.id }}">
    <textarea name="content" placeholder="Ğ’Ğ°Ñˆ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¹..." required></textarea>
    <div class="card__actions">
      <button class="btn" type="submit">ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ</button>
      <div class="muted">ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ñ‡ĞµÑ€ĞµĞ· API + Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ (WS)</div>
    </div>
  </form>
  {% endif %}

  <div id="comments">
    {% for c in comments %}
      <div class="comment">
        <div class="muted"><strong>{{ c.author.username if c.author else ('user#' ~ c.author_id) }}</strong> Â· {{ c.created_at.strftime('%Y-%m-%d %H:%M') if c.created_at else '' }}</div>
        <div>{{ c.content }}</div>
      </div>
    {% else %}
      <div class="muted">ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸ĞµĞ² Ğ¿Ğ¾ĞºĞ° Ğ½ĞµÑ‚.</div>
    {% endfor %}
  </div>
</section>
{% endblock %}
