{% extends 'base.html' %}
{% block title %}Ğ›ĞµĞ½Ñ‚Ğ° Â· MuhaBlog{% endblock %}

{% block content %}
<div class="stack">
  <form class="searchbar" method="get" action="/">
    <input name="q" value="{{ q }}" placeholder="ĞŸĞ¾Ğ¸ÑĞº Ğ¿Ğ¾ Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²ĞºÑƒ Ğ¸ Ñ‚ĞµĞºÑÑ‚Ñƒ (FTS)" />
    <select name="category" class="select">
      <option value="">Ğ’ÑĞµ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸</option>
      {% for c in categories %}
        <option value="{{ c.slug }}" {% if c.slug == category %}selected{% endif %}>{{ c.name }}</option>
      {% endfor %}
    </select>
    <button class="btn" type="submit">Ğ˜ÑĞºĞ°Ñ‚ÑŒ</button>
  </form>

  {% if request.state.is_authenticated %}
  <div class="tabs">
    <a class="tab {% if not feed %}tab--active{% endif %}" href="/?q={{ q }}&category={{ category }}">Ğ’ÑĞµ</a>
    <a class="tab {% if feed == 'following' %}tab--active{% endif %}" href="/?feed=following">ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸</a>
    <a class="tab {% if feed == 'recommended' %}tab--active{% endif %}" href="/?feed=recommended">Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸</a>
  </div>
  {% endif %}

  {% for item in items %}
    {% set p = item.post %}
    <article class="card">
      <div class="card__meta">
        <div class="muted">
          <strong>{{ item.author.username if item.author else ('user#' ~ p.author_id) }}</strong>
          Â· {{ p.created_at.strftime('%Y-%m-%d %H:%M') if p.created_at else '' }}
          Â· ğŸ‘ {{ p.view_count }}
        </div>
        <div class="badges">
          {% for c in item.categories %}
            <span class="badge" style="border-color: {{ c.color }}">{{ c.name }}</span>
          {% endfor %}
        </div>
      </div>

      <h2 class="card__title"><a href="/post/{{ p.id }}">{{ p.title }}</a></h2>
      <p class="card__excerpt">{{ p.excerpt }}</p>

      <div class="card__actions">
        <a class="btn btn--ghost" href="/post/{{ p.id }}">ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ</a>
        <span class="muted">ğŸ‘ {{ item.counts.likes }} Â· ğŸ‘ {{ item.counts.dislikes }} Â· â­ {{ item.counts.favorites }}</span>
      </div>
    </article>
  {% else %}
    <div class="muted">ĞŸĞ¾ÑÑ‚Ğ¾Ğ² Ğ¿Ğ¾ĞºĞ° Ğ½ĞµÑ‚.</div>
  {% endfor %}
</div>
{% endblock %}
